---
title: "Gráficas"
author: "JLMR"
date: 2022-01-13T21:13:14-05:00
categories: ["Gráficas"]
tags: ["Mapas", "Figuras", "Tablas"]
---


```{r setup, include=FALSE, warning=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
suppressPackageStartupMessages(library(tidyverse))
library(janitor)
library(dygraphs)
library(plotly)
```


```{r}

e4037<-read.csv("C:/Users/josel/Desktop/on/web/lector_maia_2022/ema_climatologia.csv")

e4037<-clean_names(e4037)

df<-e4037%>%mutate(max=as.numeric(as.character(tmax)),min=as.numeric(as.character(tmin)))
df<-df%>%head(-1)

datatemp<-select(df,fecha , min , max)%>%
na.omit(fecha)%>%
mutate(fecha=as.Date(fecha, "%d/%m/%Y"))

df<-mutate(df, date=as.Date(fecha, "%d/%m/%Y"))%>%
mutate(mes=as.integer(substr(date,6,7)),año=substr(date,1,4))


meses<-data.frame(Meses=c("Enero ",	"Febrero",	"Marzo",	"Abril",	"Mayo",	"Junio",	"Julio",	"Agosto",	"Septiembre",	"Octubre",	"Noviembre",	"Diciembre"),mes=seq(1, 12, by=1))

temp<-select(df, año, mes,  min, max)
temp<-left_join(meses,temp)


prom_yr<-temp%>%na.omit()%>%
  group_by(mes,año)%>%
  summarise(max_med=mean(max), min_med=mean(min))

promedio_arr<-arrange(prom_yr,año,mes)

eneros<-filter(promedio_arr, mes==1)%>%
  mutate(año=as.numeric(año))%>%
  ungroup()%>%
  select(-mes)%>%
  rename(Máxima=max_med,Mínima=min_med) 

eneros_tidy<-eneros%>%
  gather(type,temp,Máxima:Mínima)

```




```{r, echo=FALSE, warning=FALSE, message=FALSE,fig.height = 7, fig.widt}

ggplot(eneros_tidy, aes(año, temp, col=type)) + 
geom_line()  +
geom_smooth(size=1.2)+
  theme_light()+
xlab("Año")+ylab("Temperatura (c°)")+
   scale_color_discrete(labels=c("Tmax", "Tmin"))+
  labs(colour="Temperatura")+ theme(legend.position="top")+
scale_colour_brewer(palette="Set1")+
  labs(title = "Tendencia en la temperatura mes de Enero 1949-2018",
       subtitle = "Estación Meteorológica Zoh Laguna")
```


**Fuente:** CNA-SMN-CG-GMC-SMAA-CLIMATOLOGIA, BASE DE DATOS CLIMATOLOGICA, [Disponible en:](https://smn.conagua.gob.mx/tools/RESOURCES/Diarios/4037.txt) ESTACION  : 4037, NOMBRE: ZOH LAGUNA, MUNICIPIO : CALAKMUL, LATITUD: 018.592, LONGITUD: -089.417. ALTITUD: 265 msnm.


**Temperatura Máxima, Mínima Mes de Enero 1949-2018 Estación Meteorológica Zoh Laguna.**

```{r, echo=FALSE, warning=FALSE,fig.height = 7, fig.width = 8}

eneros_spread<-spread(eneros_tidy,type, temp )

interactiveplot<-dygraph(eneros_spread, main = "Temperatura promedio °C") %>%
  dyRangeSelector()%>%
    dyHighlight(highlightCircleSize = 3, 
              highlightSeriesBackgroundAlpha = 0.2,
              hideOnMouseOut = FALSE)

interactiveplot
```
**Fuente:** CNA-SMN-CG-GMC-SMAA-CLIMATOLOGIA, BASE DE DATOS CLIMATOLOGICA, [Disponible en:](https://smn.conagua.gob.mx/tools/RESOURCES/Diarios/4037.txt) ESTACION  : 4037, NOMBRE: ZOH LAGUNA, MUNICIPIO : CALAKMUL, LATITUD: 018.592, LONGITUD: -089.417. ALTITUD: 265 msnm.






```{r, echo=FALSE, warning=FALSE, message = FALSE, fig.height = 7, fig.width = 8}
library(plotly)
e4037<-read.csv("C:/Users/josel/Desktop/on/web/lector_maia_2022/ema_climatologia.csv")

e4037<-clean_names(e4037)

df<-e4037%>%mutate(max=as.numeric(as.character(tmax)),min=as.numeric(as.character(tmin)))
df<-df%>%head(-1)


df<-df%>%mutate(date=as.Date(fecha, "%d/%m/%Y"))%>%
mutate(mes=as.integer(substr(fecha,4,5)),año=substr(fecha,7,10))


meses<-data.frame(nombre=c("Enero ",	"Febrero",	"Marzo",	"Abril",	"Mayo",	"Junio",	"Julio",	"Agosto",	"Septiembre",	"Octubre",	"Noviembre",	"Diciembre"),mes=seq(1, 12, by=1))

df<-left_join(meses,df)

tidy<-gather(df, tipo, temperatura, max:min)%>%
  mutate(tipo=as.factor(tipo), temperatura=as.numeric(as.character(temperatura)))

legend_title <- ""

box<-ggplot(tidy, aes(x=fct_inorder(nombre), y=temperatura)) + geom_boxplot(aes(fill=tipo))+
xlab("Mes")+
ylab("Temperatura diaria °C")+
theme_light()+
  theme(axis.text.x = element_text(angle = 90))+
  theme(legend.title=element_blank())+ scale_fill_manual(legend_title,values=c("firebrick1", "cyan2"),
labels=c("Máxima", "Mínima"))+
  labs(title = "Variación en la temperatura diaria 1949-2018",
       subtitle = "Estación Meteorológica Zoh Laguna",
       caption = "**Fuente:** CNA-SMN-CG-GMC-SMAA-CLIMATOLOGIA, BASE DE DATOS CLIMATOLOGICA, [Disponible en:](https://smn.conagua.gob.mx/tools/RESOURCES/Diarios/4037.txt) ESTACION  : 4037, NOMBRE: ZOH LAGUNA, MUNICIPIO : CALAKMUL, LATITUD: 018.592, LONGITUD: -089.417. ALTITUD: 265 msnm.")  



ggplotly(box)

```
**Fuente:** CNA-SMN-CG-GMC-SMAA-CLIMATOLOGIA, BASE DE DATOS CLIMATOLOGICA, [Disponible en:](https://smn.conagua.gob.mx/tools/RESOURCES/Diarios/4037.txt) ESTACION  : 4037, NOMBRE: ZOH LAGUNA, MUNICIPIO : CALAKMUL, LATITUD: 018.592, LONGITUD: -089.417. ALTITUD: 265 msnm.


Evolución de la precipitación promedio mensual 1949-2018

```{r, fig.height =6, fig.width = 8}
e4037<-read.csv("C:/Users/josel/Desktop/on/web/lector_maia_2022/ema_climatologia.csv")
## to lower case var names.

e4037<-clean_names(e4037)%>%na.omit()%>%
  filter(precip!="Nulo")



lluvia<-mutate(e4037, precip=as.numeric(precip), date=as.Date(fecha, "%d/%m/%Y"))%>%
mutate(mes=as.integer(substr(date,6,7)),año=substr(date,1,4))%>%
  select(precip,mes, año, date  )

meses<-data.frame(Meses=c("Enero ",	"Febrero",	"Marzo",	"Abril",	"Mayo",	"Junio",	"Julio",	"Agosto",	"Septiembre",	"Octubre",	"Noviembre",	"Diciembre"),mes=seq(1, 12, by=1))

rain<-left_join(meses,lluvia)%>%
  mutate(mes=as.factor(mes), año=as.factor(año))


incomplete<-data.frame(años=c("1949", "1982", "1974","1977"))


lluvia_mes<-group_by(rain,  año, mes)%>%
 summarize(total=sum (precip))%>%
  ungroup()


lluvia2<-group_by(lluvia_mes,mes)%>%
  summarize(avg=mean(total))

meses<-mutate(meses,mes=as.factor(mes))
lluvia2<-left_join(lluvia2, meses)%>%
  mutate(mes=as.numeric(mes), Meses=as.factor(Meses))



a<-ggplot(lluvia2,  aes(x=reorder(Meses,mes), y=avg,group=1))+
    geom_smooth(color="steelblue4")+
  xlab("Mes")+
  ylab("Precipitación 1949-2018 (mm)")+
  theme_light()+
theme(axis.text.x = element_text(angle = 45, hjust = .8))+
  geom_vline(xintercept =8, linetype="dashed", 
                color = "red2", size=.8)
   
a

```

